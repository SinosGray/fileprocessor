---
categories:
- language
date: 2020-04-01 18:42:38
tags:
- mov
- eax
- ebp
- jump
- dword
title: æ±‡ç¼–
---

>å…³äºæ±‡ç¼–è¯­è¨€çš„æ€»ç»“, åŸåˆ™æ˜¯åªè®°å½•è¦ç‚¹

<!--more-->

## å®ä¾‹

### æ•´æ•°åŠ å‡

```assembly
.386
.model flat, stdcall
;flat: å†…å­˜æ¨¡å¼, stdcall: å­ç¨‹åºè°ƒç”¨è§„èŒƒ
.stack 4096
;æ ˆå¤§å°
ExitProcess PROTO, dwExitCode:DWORD
;æ ‡å‡† windows æœåŠ¡
.code
main PROC
 mov eax, 5
 add eax, 6
 
 INVOKE ExitProcess, 0
main ENDP
END main
```

### å­ç¨‹åº

æ³¨æ„é—®é¢˜

1. æ¸…é™¤å †æ ˆå‚æ•°
2. ä¿å­˜å¯„å­˜å™¨ç°åœº, å¯ä»¥ç”¨`uses eax...`
3. å±€éƒ¨å˜é‡

```assembly
;c è°ƒç”¨è§„èŒƒ
main proc
	push 5
	push 6
	call addtwo
	add esp, 8;ç§»é™¤å †æ ˆå‚æ•°
	mov eax, ebx

y_param equ [ebp+12]
x_param equ [ebp+8]
addtwo proc
	push ebp
	mov ebp, esp; 
	mov eax, y_param
	add eax, x_param
	pop ebp
	ret
mysub endp
```

```assembly
;stdcall è§„èŒƒ
main proc
	push 5
	push 6
	call addtwo
	mov eax, ebx

y_param equ [ebp+12]
x_param equ [ebp+8]
addtwo proc
	push ebp
	mov ebp, esp
	mov eax, y_param
	add eax, x_param
	pop ebp
	ret 8;æ¸…é™¤å †æ ˆ
mysub endp
```

```assembly
;å±€éƒ¨å˜é‡
x_local equ dword ptr [ebp-4]
y_local equ dword ptr [ebp-8]
addtwo proc
	push ebp
	mov ebp, esp
	;åˆ›å»ºå±€éƒ¨å˜é‡
	sub esp, 8
	mov x_local, 10
	mov y_local, 20
	
	;åˆ é™¤å±€éƒ¨å˜é‡
	mov esp, ebp
	
	pop ebp
	ret 8;æ¸…é™¤å †æ ˆ
mysub endp
```

![æˆªå±2021-06-07 ä¸‹åˆ10.39.50](https://tva1.sinaimg.cn/large/008i3skNgy1gra2yw99r9j30mo0lyn3b.jpg)

## æ±‡ç¼–è¦ç‚¹æ€»ç»“

### æ“ä½œæ¨¡å¼

#### ä¿æŠ¤æ¨¡å¼

æ‰€æœ‰æŒ‡ä»¤ç‰¹æ€§å¯ç”¨, åˆ†é…ç»™ç¨‹åºçš„ç‹¬ç«‹å†…å­˜åŒºåŸŸå«**æ®µ**

32 ä½ä¿æŠ¤æ¨¡å¼ä¸‹, å¯å¯»å€ 4GB åœ°å€ç©ºé—´

##### 	è™šæ‹Ÿ 8086 æ¨¡å¼

ä¿æŠ¤æ¨¡å¼çš„ä¸€ä¸ªå­æ¨¡å¼

#### å®åœ°å€æ¨¡å¼

ç¨‹åºç›´æ¥è®¿é—®ç³»ç»Ÿå†…å­˜å’Œç¡¬ä»¶è®¾å¤‡

å¯»å€ 1MB åœ°å€ç©ºé—´

#### ç³»ç»Ÿç®¡ç†æ¨¡å¼

ç”µæºç®¡ç†, ç³»ç»Ÿå®‰å…¨, é€šå¸¸ç”±è®¡ç®—æœºåˆ¶é€ å•†å®ç°

### å¯„å­˜å™¨

- æ•°æ®å¯„å­˜å™¨ç»„(å¯ä»¥ç”¨ä½œ 16, 8 ä½, ä½†æ˜¯æ­¤æ—¶ä¸èƒ½ç”¨ä½œæŒ‡ç¤ºå™¨, å˜å€å¯„å­˜å™¨?)
  - EAX ç´¯åŠ å™¨, ä¹˜é™¤æŒ‡ä»¤é»˜è®¤ä½¿ç”¨, ä¹˜æ³•ä¹˜æ•°å’Œç§¯, é™¤æ³•è¢«é™¤æ•°å’Œå•†
  - EBX åŸºå€å¯„å­˜å™¨
  - ECX è®¡æ•°å¯„å­˜å™¨, é»˜è®¤å¾ªç¯è®¡æ•°
  - EDX æ•°æ®å¯„å­˜å™¨, ä¹˜æ³•é«˜ä½, é™¤æ³•ä½™æ•°
- æŒ‡ç¤ºå™¨å˜å€å¯„å­˜å™¨ç»„(å­˜æ”¾åç§»åœ°å€, ç”¨ä½œæŒ‡ç¤ºå™¨æˆ–è€…å˜å€å¯„å­˜å™¨, å¯ç”¨ä½œ 16, ä¸èƒ½ç”¨ä½œ 8)
  - ESI æºæ“ä½œæ•°æŒ‡ç¤ºå™¨
  - EDI ç›®çš„æ“ä½œæ•°æŒ‡ç¤ºå™¨
  - EBP åŸºå€å¯„å­˜å™¨
  - ESP ä¸“ç”¨å †æ ˆæŒ‡ç¤ºå™¨, ä¸€èˆ¬ä¸åšæ•°æ®å¯„å­˜å™¨
- æ®µå¯„å­˜å™¨
  - CS ä»£ç æ®µå¯„å­˜å™¨
  - SS 
  - DS 
  - ES, FS, GS 
- æŒ‡ä»¤æŒ‡é’ˆ
  - EIP ä¿æŠ¤ä¸‹ä¸€æ¡å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€

- æ ‡å¿—å¯„å­˜å™¨ EFLAGS
  - zf: é›¶æ ‡å¿—ä½, ç›¸å…³æŒ‡ä»¤æ‰§è¡Œåç»“æœä¸º **0** åˆ™ zf=1, å¦åˆ™ 0
    mov ax,1
    sub ax,1
  - pf: å¥‡å¶æ ‡å¿—ä½, **ç»“æœä¸­ 1 ä¸ºå¶æ•°** pf=1, å¦åˆ™ 0
  - sf: ç¬¦å·æ ‡å¿—ä½, ç»“æœä¸º**è´Ÿ**, sf=1, å¦åˆ™ä¸º 0
  - cf: è¿›ä½æ ‡å¿—ä½, åœ¨è¿›è¡Œ**æ— ç¬¦å·**æ•°è¿ç®—çš„æ—¶å€™ï¼ŒCFè®°å½•äº†è¿ç®—ç»“æœçš„æœ€é«˜æœ‰æ•ˆä½å‘æ›´é«˜æœ‰æ•ˆä½å‘æ›´é«˜ä½çš„è¿›ä½å€¼/å€Ÿä½å€¼,äº§ç”Ÿè¿›ä½æˆ–å‘æ›´é«˜ä½å€Ÿä½éƒ½ä¼šä½¿CF=1
  - of: æº¢å‡ºæ ‡å¿—ä½, **æœ‰ç¬¦å·**è¿ç®—ç»“æœå¤ªå¤§æˆ–å¤ªå° of=1, å¦åˆ™ 0

### æ•°æ®ç±»å‹

byte 8, word 16, dword 32, qword 64

### æ ˆ

![è¿™é‡Œå†™å›¾ç‰‡æè¿°](https://img-blog.csdn.net/20180214135628549?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYWJjXzEyMzY2/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

32 ä½å…¥æ ˆæ“ä½œæ ˆé¡¶æŒ‡é’ˆ-4

### æŒ‡ä»¤

#### mov

```assembly
;mov ä¸èƒ½ä»å†…å­˜åˆ°å†…å­˜
var word ?
mov ax, var;å°† var å†…å­˜çš„å€¼èµ‹ç»™ ax å¯„å­˜å™¨, è€Œä¸æ˜¯åœ°å€, æ‰€ä»¥ mov æŒ‡ä»¤å«æ•°æ®ä¼ é€æŒ‡ä»¤
;movzx 0 æ‰©å±•
;movsx ç¬¦å·æ‰©å±•
;xchg äº¤æ¢ä¸¤ä¸ªæ“ä½œæ•°çš„å†…å®¹
array byte 10h, 20h, 30h, 40h
mov al, array;å°† array çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ä¼ é€åˆ° al
mov al, [array+1];å°† array çš„ç¬¬äºŒä¸ªå­—èŠ‚ä¼ é€åˆ° al
mov al, [esi];è§£æ esi ä¸­çš„åç§»é‡, å°†æ•°æ®ä¼ åˆ° al ä¸­, å•ç‹¬ä½¿ç”¨[esi]éœ€è¦ ptr é™åˆ¶å¤§å°
```

#### ç®—æ•°æŒ‡ä»¤

```assembly
;è‡ªå¢è‡ªå‡ inc dec
inc ax

;åŠ æ³• add
add eax, var; eax+var->eax

;å‡æ³• sub
sub eax, var;eax-var->eax

;å–è´Ÿ neg 
neg eax

;ä¹˜æ³• mul æ— ç¬¦å·æ•°ä¹˜æ³•
mov al, 5h
mov bl, 10h
mul bl;bl*al->ax
;ä¹˜æ³• imul æœ‰ç¬¦å·æ•°ä¹˜æ³•
;å•æ“ä½œæ•°
imul bx;ax*bx->dx:ax
;åŒæ“ä½œæ•°
imul ax, var;ax*var->ax æœ‰æˆªæ–­
;ä¸‰æ“ä½œæ•° imul reg, reg/mem, imm
imul ax, bx, 8;bx*8->ax

;é™¤æ³• div æ— ç¬¦å·æ•°é™¤æ³•
mov ax, 0083h
mov bl, 2
div bl;al = ax/bl, ah = ax%bl
;é™¤æ³• idiv æœ‰ç¬¦å·æ•°é™¤æ³•
;å•æ“ä½œæ•°
.data
byteval sbyte -48
.code
mov al, byteval
cbw;æ‰©å±•ç¬¦å·
mov bl, +5
idiv bl; al = -9, ah = -3

;å¸ƒå°”è¿ç®—: and, or, xor, not, test=and ä½†æ˜¯ä¸æ”¹å˜ç›®æ ‡æ“ä½œæ•°

;ç§»ä½
;shl å·¦ç§» sal ç®—æ•°å·¦ç§» rol å¾ªç¯å·¦ç§»
;shr å³ç§»è¡¥ 0 sar ç®—æ•°å³ç§»è¡¥ç¬¦å·ä½ ror å¾ªç¯å³ç§»
```

#### å¾ªç¯

```assembly
;loop ecx æ¯æ¬¡å¾ªç¯-1
mov ax, 0
mov ecx, 5; åˆå§‹åŒ–ä¸º 0 ä¸åœæ­¢
L1:
inc ax
loop L1
;loopz = loope, ç­‰äº ecx=ecx-1, if ecx>0 and zf=1 then jump to destination
```

#### è·³è½¬

```assembly
;cmp jcond
cmp eax, 5
je L1
;jcond
;ABOVE, BELOW æ— ç¬¦å·, GREATER LESS æœ‰ç¬¦å·
JA; JUMP WHEN ABOVE
JNA; JUMP WHEN NOT ABOVE
JAE; JUMP WHEN ABOVE OR EQUAL
JNAE; JUMP WHEN NOT ABOVE OR EQUAL ä¸å¤§äº, ä¸”ä¸ç­‰äº

JB; JUMP WHEN BELOW
JNB; JUMP WHEN NOT BELOW
JBE; JUMP WHEN BELOW OR EQUAL
JNBE; JUMP WHEN NOT BELOW OR EQUAL

JG; JUMP WHEN GREATER
JNG; JUMP WHEN NOT GREATER
JGE; JUMP WHEN GREATER OR EQUAL
JNGE; JUMP WHEN NOT GREATER OR EQUAL 

JL; JUMP WHEN LESS
JNL; JUMP WHEN NOT LESS
JLE; JUMP WHEN LESS OR EQUAL
JNLE; JUMP WHEN NOT LESS OR EQUAL

JE; JUMP WHEN EQUAL
JZ; JUMP WHEN HAS ZERO FLAG JZ=JE
JNE; JUMP WHEN NOT EQUAL
JNZ; JUMP WHEN NOT HAS ZERO FLAG
JO; JUMP WHEN HAS OVERFLOW FLAG
JC; JUMP WHEN HAS CARRY FLAG
;pf: å¥‡å¶æ ‡å¿—ä½, ç»“æœä¸­ 1 ä¸ºå¶æ•° pf=1, å¦åˆ™ 0
JP; JUMP WHEN HAS PARITY(å¥‡å¶) FLAG å¶æ ¡éªŒ
JNP; JUMP WHEN NOT HAS PARITY FLAG å¥‡æ ¡éªŒ
JS; JUMP WHEN HAS SIGN FLAG
JNS; JUMP WHEN NOT HAS SIGN FLAG
```

#### å­ç¨‹åºä¸å †æ ˆ

```assembly
;push å…ˆå‡å°‘ esp, å†å°†æ“ä½œæ•°å¤åˆ¶åˆ°å †æ ˆ
;pop å…ˆå°†æ“ä½œæ•°å¤åˆ¶, å†å¢åŠ  esp
;pushfd ä¿å­˜ flags, popfd æ¢å¤ flags
;pushad popad 32 ä½, pusha popa 16 ä½

;call 1.è°ƒç”¨ä¹‹åçš„åœ°å€å‹å…¥å †æ ˆ 2.å­ç¨‹åºåœ°å€åŠ è½½åˆ° eip
;ret 1.esp æŒ‡å‘çš„æ•°å€¼å¼¹å‡ºåˆ° eip

;uses ä¿æŠ¤å¯„å­˜å™¨, é¦–å°¾åŠ  push pop, ä½†æ˜¯å­ç¨‹åºä¸­ä¸èƒ½ä½¿ç”¨ esp+åç§»é‡
arraysum proc uses esi ecx
	mov eax, 0
L1:
	add eax, [esi]
	add esi, type dword
	loop L1
	ret
arraysum endp

;enter numbytes, nestinglevel/0
;1.push ebp 2.mov ebp, esp 3.sub esp, numbytes
mysub proc
	enter 8, 0
	
;leave 
;1.mov esp, ebp 2.pop ebp

;invoke
push type array
push lengthof array
push offset array
call dumparray
;ç­‰æ•ˆäº, å…¶ä¸­ offset array å¯ä»¥æ¢ä¸º addr array
invoke dumparray, offset array, lengthof array, type array

;proto æŒ‡å®šç¨‹åºçš„å¤–éƒ¨è¿‡ç¨‹
exitprocess proto
.code
mov ecx, 0
call exitprocess
;å‡½æ•°å®šä¹‰
arraysum proc uses esi ecx
	ptrarray:ptr dword,
	szarray:dword
arraysum endp
;å‡½æ•°å£°æ˜
arraysum proto, ptrarray:ptr dword, szarrya:dword
```

#### å­—ç¬¦ä¸²

```assembly
;é‡å¤æŒ‡ä»¤
;repe å¦‚æœç›¸ç­‰ç»§ç»­, ä»¥ ecx ä¸ºè®¡æ•°å™¨

;movsb, movsw, movsd å°† esi å†…å­˜æ•°æ®å¤åˆ¶åˆ° edi å†…å­˜ä½ç½®
cld;æ¸…é™¤æ–¹å‘æ ‡å¿—ä½, cld æ­£å‘, std åå‘
mov esi, offset string1
mov edi, offset string2
mov ecx, 10
rep movsb;å°† esi ä¸­çš„åä¸ªå­—èŠ‚ä¼ é€åˆ° edi å¯»å€çš„å†…å­˜ä½ç½®(string2)

;cmpsb, cmpsw, cmpsd æ¯”è¾ƒ esi å’Œ edi å¯»å€çš„å†…å­˜æ•°æ®
.data
source dword 1234h
target dword 5678h
.code
mov esi, offset source
mov edi, offset target
cld
mov ecx, lengthof source
repe cmpsd;æ¯”è¾ƒåŒå­—, å¦‚æœç›¸ç­‰å°±é‡å¤, ç›´åˆ° ecx=0 æˆ–è€…å‘ç°ä¸ç›¸ç­‰

;scasb, scasw, scasd æ¯”è¾ƒç´¯åŠ å™¨ al, ax, wax ä¸ edi å¯»å€çš„å†…å­˜æ•°æ®
.data
alpha byte "abcdefgh", 0
.code
mov edi, offset alpha
mov al, 'f'
mov ecx, lengthof alpha
cld
repne scasb;å¦‚æœä¸ç›¸ç­‰å°±ç»§ç»­æ¯”è¾ƒ
jnz quit;å¦‚æœæœªå‘ç°å­—ç¬¦å°±é€€å‡º

;stosb, stosw, stosd å°†ç´¯åŠ å™¨å†…å®¹ä¿å­˜åˆ° ediå¯»å€çš„å†…å­˜ä½ç½®
.data
count = 100
string1 byte count dup(?)
.code
mov al, 0ffh
mov edi, offset string1
mov ecx, count
cld
rep stosb;ç”¨ al å°† string1 å¡«å……

;lodsb, lodsw, lodsd å°† esi å¯»å€çš„å†…å­˜æ•°æ®åŠ è½½åˆ°ç´¯åŠ å™¨
;å°†æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ä¹˜ä¸€ä¸ªå¸¸æ•°
.data
array dword 1,2,3,4,5,6,7,8,9,10
multiplier dword 10
.code
main proc
	cld
	mov esi, offset array
	mov edi, esi
	mov ecx, lengthof array
L1:lodsd
	mul multiplier
	stosd
	loop L1
	exit
main endp
end main
```



#### å…¶ä»–

```assembly
;ç­‰å·ä¼ªæŒ‡ä»¤, å°†ç¬¦å·å’Œä¸€ä¸ªæ•´æ•°è¡¨è¾¾å¼è¿æ¥èµ·æ¥
count = 100
;EQU ä¼ªæŒ‡ä»¤, å°†ç¬¦å·å’Œä¸€ä¸ªæ•´æ•°è¡¨è¾¾å¼æˆ–è€…ä»»æ„æ–‡æœ¬è¿æ¥èµ·æ¥
count EQU 100
count equ <100>;æ–‡æœ¬æ›¿æ¢

;$å½“å‰åœ°å€è®¡æ•°å™¨

;lea è¿”å›é—´æ¥æ“ä½œæ•°çš„åœ°å€
makearray proc
	push ebp
	mov ebp, esp
	sub esp, 32
	lea esi, [ebp-30]
	;mov esi, offset [ebp-30]ä¸å¯, å› ä¸º offset åªèƒ½ç”¨äºç¼–è¯‘æ—¶å·²çŸ¥çš„åœ°å€
	mov ecx, 30
L1:
	mov byte ptr [esi], '*'
	inc esi
	loop L1
	add esp, 32
	pop ebp
	ret
makearray endp

;offset è¿”å›ä¸€ä¸ªå˜é‡ä¸å…¶æ‰€åœ¨æ®µèµ·å§‹åœ°å€ä¹‹é—´çš„è·ç¦»
mov esi, offset var; esi ä¸­ä¸º var å˜é‡çš„åç§»åœ°å€
mov esi, offset array + 4;å…ˆå¾—åˆ° array çš„åç§»é‡å†åŠ  4

;ptr é‡å†™æ“ä½œæ•°é»˜è®¤çš„å¤§å°ç±»å‹
.data
myDouble dword 12345678h
.code
mov ax, word ptr myDouble;ax = 5678h å°ç«¯
;ç›´æ¥ mov ax, myDouble æ˜¯ä¸å…è®¸çš„

;type è¿”å›æ“ä½œæ•°æˆ–æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„å¤§å°(å­—èŠ‚)
;lengthof è¿”å›æ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°
;sizeof è¿”å›æ•°ç»„åˆå§‹åŒ–æ—¶ä½¿ç”¨çš„å­—èŠ‚æ•°
;typedef åˆ›å»ºç”¨æˆ·å®šä¹‰ç±»å‹
pbyte typedef ptr byte
```

### dosbox

```shell
mount c ~/Desktop/netclass/asm/asm/dosbox
c:
dir
```



### åŸºç¡€:

[æ•°åˆ¶è½¬æ¢](https://tool.oschina.net/hexconvert)

- ä½¿ç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™çš„æºä»£ç ï¼Œç„¶åé€šè¿‡ç›¸åº”çš„æ±‡ç¼–ç¨‹åºå°†å®ƒä»¬è½¬æ¢æˆå¯æ‰§è¡Œçš„æœºå™¨ä»£ç ã€‚è¿™ä¸€è¿‡ç¨‹è¢«ç§°ä¸º**æ±‡ç¼–è¿‡ç¨‹**ã€‚

- æ™®éåœ°è¯´ï¼Œæ¯ä¸€ç§ç‰¹å®šçš„æ±‡ç¼–è¯­è¨€å’Œå…¶ç‰¹å®šçš„æœºå™¨è¯­è¨€æŒ‡ä»¤é›†æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚
- DB, DW, DD, DQ, DT ä¾æ¬¡ä¸º 1, 2, 4, 8, 10
- [x86](https://zh.wikipedia.org/wiki/X86)/[amd64](https://zh.wikipedia.org/wiki/Amd64)æ±‡ç¼–æŒ‡ä»¤çš„ä¸¤å¤§é£æ ¼åˆ†åˆ«æ˜¯[Intel](https://zh.wikipedia.org/wiki/Intel)æ±‡ç¼–ä¸[AT&T](https://zh.wikipedia.org/wiki/AT%26T)æ±‡ç¼–ï¼Œåˆ†åˆ«è¢«[Microsoft Windows](https://zh.wikipedia.org/wiki/Microsoft_Windows)/[Visual C++](https://zh.wikipedia.org/wiki/Visual_C%2B%2B)ä¸[GNU](https://zh.wikipedia.org/wiki/GNU)/[Gas](https://zh.wikipedia.org/wiki/GNUæ±‡ç¼–å™¨)é‡‡ç”¨ï¼ˆGasä¹Ÿå¯ä½¿ç”¨Intelæ±‡ç¼–é£æ ¼ï¼‰

- | é¡¹ç›®                                                        | Intelé£æ ¼(dosboxä½¿ç”¨çš„æ˜¯è¿™ç§)                                | AT&Té£æ ¼                          |
  | :---------------------------------------------------------- | :----------------------------------------------------------- | :-------------------------------- |
  | æ“ä½œæ•°é¡ºåº                                                  | ç›®æ ‡æ“ä½œæ•°åœ¨å‰                                               | æºæ“ä½œæ•°åœ¨å‰                      |
  | å¯„å­˜å™¨                                                      | **åŸæ ·**                                                     | åŠ %å‰ç¼€                           |
  | ç«‹å³æ•°                                                      | **åŸæ ·**                                                     | åŠ $å‰ç¼€                           |
  | 16è¿›åˆ¶ç«‹å³æ•°                                                | ç”¨åç¼€Bä¸Håˆ†åˆ«è¡¨ç¤ºäºŒè¿›åˆ¶ä¸åå…­è¿›åˆ¶ å¯¹äº16è¿›åˆ¶å­—æ¯å¼€å¤´çš„è¦åŠ å‰ç¼€0 | åŠ å‰ç¼€0x                          |
  | è®¿é—®å†…å­˜é•¿åº¦çš„è¡¨ç¤º                                          | å‰ç¼€BYTE PTR, WORD PTR, DWORD PTRå’ŒQWORD PTRè¡¨ç¤ºå­—èŠ‚,å­—,åŒå­—å’Œå››å­— | åç¼€b,w,l,qè¡¨ç¤ºå­—èŠ‚,å­—,åŒå­—å’Œå››å­— |
  | å¼•ç”¨å…¨å±€æˆ–é™æ€å˜é‡varçš„å€¼                                   | [**var**]                                                    | var                               |
  | å¼•ç”¨å…¨å±€æˆ–é™æ€å˜é‡varçš„åœ°å€                                 | **var**                                                      | $var                              |
  | å¼•ç”¨å±€éƒ¨å˜é‡                                                | éœ€è¦åŸºäºæ ˆæŒ‡é’ˆï¼ˆrspï¼‰                                        |                                   |
  | ç»å¯¹å¯»å€                                                    | [imm]                                                        | imm                               |
  | é—´æ¥å¯»å€                                                    | [reg]                                                        | (%reg)                            |
  | åŸºå€ç›¸å¯¹å¯»å€                                                | [reg +imm]                                                   | imm(%reg)                         |
  | å˜å€å¯»å€                                                    | [base+index]                                                 | (base,index)                      |
  | å˜å€å¯»å€                                                    | imm[base+index]                                              | imm(base,index)                   |
  | æ¯”ä¾‹å˜å€å¯»å€                                                | imm[base + index * scale ]                                   | imm(base, index, scale)           |
  | scaleåªèƒ½æ˜¯1,2,4,8å…¶ä¸­çš„ä¸€ä¸ªæ•°å­—(1çœç•¥ä¸å†™å°±æ˜¯æ™®é€šå˜å€å¯»å€) |                                                              |                                   |
  | ä»£ç æ³¨é‡Š                                                    | å•è¡Œæ³¨é‡Šç”¨;+æ³¨é‡Šå†…å®¹ã€‚ä¾‹å¦‚:mov   rax, rdx ;è¿™é‡Œæ˜¯æ³¨é‡Š        |                                   |
  | æ³¨æ„                                                        | è¿™é‡Œimmä¸ºç«‹å³æ•°,baseå’Œindexä¸ºå¯„å­˜å™¨,scaleä¸ºä¼¸ç¼©é‡            |                                   |

### åŒºåˆ† åœ°å€ å’Œ æ•°

- ä¸¾ä¾‹

  ```assembly
  DS: [1000h]; è¿™æ˜¯ä¸€ä¸ªåœ°å€, ä½ç½®æ˜¯ 1000h
  3000h; è¿™æ˜¯ä¸€ä¸ªæ•°, å¤§å°æ˜¯ 3000h
  
  ```
  - åŠ©è®°ç¬¦--->æœºå™¨æŒ‡ä»¤
  - å˜é‡--->æ“ä½œæ•°å­˜æ”¾åœ°å€
  - æŒ‡ä»¤å‰çš„æ ‡å·--->è¯¥æŒ‡ä»¤çš„å­˜æ”¾åœ°å€

### ä¸ºä»€ä¹ˆè¦åˆ†æ®µ(å†…å­˜, è™šæ‹Ÿå†…å­˜, åˆ†æ®µéƒ¨ä»¶, åˆ†é¡µéƒ¨ä»¶)

- å†å²

  - 1978å¹´ æ¨å‡º 16 ä½ cpu8086, å†…å¤–æ•°æ®çº¿ä¸º 16 ä½, åœ°å€æ€»çº¿ä¸º 20 ä½, ä¸»å­˜å¯»å€ 1MB
  - 1982å¹´ æ¨å‡º         cpu80286, å†…å¤–æ•°æ®çº¿ä¸º 16 ä½, åœ°å€æ€»çº¿ä¸º 24 ä½, ä¸»å­˜å¯»å€ 16MB
  - 1985å¹´ æ¨å‡º32ä½ cpu80386, å†…å¤–æ•°æ®çº¿ä¸º 32 ä½, åœ°å€æ€»çº¿ä¸º 32 ä½, ä¸»å­˜å¯»å€ 4GB(1MB*2^12)

- ç‰©ç†åŸå› 

  - æ€»çº¿ 20 ä½ ---> å¯»å€ 1MB
  - æ€»çº¿ 32 ä½ ---> å¯»å€ 4G
  - æ®µå¯„å­˜å™¨ä¸º 16 ä½ ---> æ®µçš„å¤§å°ä¸º 64K 
  - **æœ€ä½ç«¯ 80X86 16 ä½è™šæ‹Ÿæœºä¸­, å†…éƒ¨ç»“æ„æ˜¯ 16 ä½, ä¸»çº¿æ˜¯ 20 ä½, ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜:**
    - å°† 1MB(20 ä½)çš„ä¸»å­˜æŒ‰ 64KB(16 ä½)åˆ†æ®µ
    - è®¾ç½®å››ä¸ªæ®µå¯„å­˜å™¨ CS, DS, SS, ES ä¿å­˜æ®µé¦–å€(20 ä½çš„é«˜ 16 ä½), å°†è¿™ä¸ª 16 ä½(å·¦ç§»å››ä½å†å˜æˆ 20 ä½)åŠ ä¸Šæ•°æ®çš„åç§»åœ°å€å°±å¾—åˆ°äº†ç‰©ç†åœ°å€
    - å…¶ä¸­ CS--->IP, SS--->SP, ä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦å®šä¹‰é™„åŠ æ•°æ®æ®µ, å¦‚æœå¿…é¡»å®šä¹‰, æœ€ç®€å•çš„æ–¹æ³•æ˜¯è®©é™„åŠ æ•°æ®æ®µä¸æ•°æ®æ®µé‡åˆ. 

  - 32 ä½æš‚æ—¶æ²¡çœ‹ğŸ˜¬

- - 

### å†…å­˜ä¸­çš„æ•°æ®å­˜æ”¾

- é«˜å…«ä½åœ¨åœ¨é«˜åœ°å€, ä½å…«ä½åœ¨ä½åœ°å€



### å¯„å­˜å™¨å¯»å€

- å¯„å­˜å™¨å¯»å€ MOV AX, BX
- å¯„å­˜å™¨é—´æ¥å¯»å€ MOV AX, [SI] ; AX=åœ°å€ä¸º SI çš„å€¼ çš„å€¼
- å˜å€å¯»å€ MOV AL, [R*F] + V; å…¶ä¸­ F åº”è¯¥æ˜¯ä¸ºäº†åº”å¯¹å­—èŠ‚, å­—, åŒå­—çš„
- åŸºå€åŠ å˜å€å¯»å€ MOV AX, [BR+IR*F+V]; é»˜è®¤æ®µå¯„å­˜å™¨ç”± BR å†³å®š,  ä¸ºäº†è¡¨ç¤ºçŸ©é˜µ
- ç«‹å³å¯»å€ MOV AX, 036H
- ç›´æ¥å¯»å€ MOV DS:[20H], CL

### å­ç¨‹åº

- NEAR FAR
  - NEAR å¯çœç•¥
  - FAR 
  - åŒºåˆ«ä¸»è¦åœ¨äº NEAR åªæ˜¯æŠŠ ip å…¥æ ˆ, æŠŠ ea èµ‹å€¼ç»™ ip, FAR åœ¨ NEAR çš„åŸºç¡€ä¸Šè¿˜è¦æŠŠ CS å…¥æ ˆ(æœ€å…ˆå…¥ cs, å†å…¥ ip)
- RET æ ¹æ® NEAR è¿˜æ˜¯ FAR å‡ºæ ˆ
- ä¼ é€’å‚æ•°
  - å¯„å­˜å™¨æ³•
  - çº¦å®šå•å…ƒæ³•
  - å †æ ˆæ³•

### æ¨¡å—åŒ–å¤„ç†

```assembly
F2T10.ASM
NAME F2T10
PUBLIC F2T10; è¿™é‡Œçš„ public æŒ‡æ˜äº† F2T10 æ˜¯å¯ä»¥è¢«å…¶ä»–æ¨¡å—è°ƒç”¨çš„, è¯¥è¯­å¥å¯ä»¥æ”¾åœ¨ä»»ä½•åœ°æ–¹
DATA  SEGMENT  USE16 PARA    PUBLIC 'DATA'
;æ®µå segment ä½¿ç”¨ç±»å‹ å®šä½æ–¹å¼ ç»„åˆæ–¹å¼ 'ç±»åˆ«'
;å®šä½æ–¹å¼ä¸­paraä¸ºé»˜è®¤, å®šä¹‰æ®µåœ¨ä»€ä¹ˆæ ·çš„èµ·å§‹è¾¹ç•Œå¼€å§‹
;ç±»åˆ«çš„ä½œç”¨æ˜¯ç”Ÿæˆ exe çš„æ—¶å€™è¿›è¡Œåˆ†ç»„(åˆ†é…ç©ºé—´)
;ç»„åˆæ–¹å¼è¿åœ¨ä¸€èµ·, public åŒç±»åˆ«æ®µä¼šæ”¾åœ¨ä¸€èµ·
...
DATA ENDS

CODE SEGMENT USE16 PARA PUBLIC 'CODE'
ASSUME CS:CODE, DS:DATA
F2T10 PROC
...
F2T10 ENDP
CODE ENDS
END
-----------------------------------------
MAIN.ASM
;ä»¥ä¸Šæ˜¯ä¸€ä¸ªå­æ¨¡å—, ä¸‹é¢çš„æ˜¯ä¸»æ¨¡å—
NAME MAIN
EXTRN F2T10:NEAR; è¿™é‡ŒæŒ‡æ˜ F2T10 æ˜¯å¤–éƒ¨æ¨¡å—çš„, ä¾‹å¦‚å­ç¨‹åº, å¦‚æœä¸¤ä¸ªä»£ç å—çš„ç±»åˆ«åç›¸åŒ, ç›¸å½“äºåœ¨ä¸€ä¸ªæ®µé‡Œ, ç”¨ EXTRN F2R10:NEAR, å¦åˆ™ç”¨ far
IF1 
;IF XXX ... ELSE ... ENDIF å¦‚æœæ¡ä»¶æˆç«‹å°±æ‰§è¡Œå—ä¸­çš„è¯­å¥, å…¶ä¸­if æœ‰å‡ ä¸ªå›ºå®šæ­é…
	INCLUDE MACRO.LIB
ENDIF
.386
DATA SEGMENT USE16 PARA PUBLIC 'DATA'
...
DATA ENDS

CODE SEGMENT USE16 PARA PUBLIC 'CODE'
ASSUME CS:CODE, DS:DATA
START:...
CODE ENDS
START END

masm main.asm
masm F2T10.asm
ç„¶åæ‰§è¡Œ:LINK MAIN+F2T10;ç”Ÿæˆ main.exe
```





### å­—ç¬¦ä¸²æ“ä½œ

- é»˜è®¤:
  - æºä¸²æŒ‡ç¤ºå™¨ SI
  - ç›®çš„ä¸²æŒ‡ç¤ºå™¨ DI
  - é‡å¤æ¬¡æ•° CX
  - SCAS æœç´¢å€¼ AX
  - LODS ç›®çš„åœ°å€ AX
  - STOS æºåœ°å€
- MOVS
- CMPS
  - REPE CMPS æœªæ¯”è¾ƒå®Œä¸”ç›¸ç­‰æ—¶ç»§ç»­
  - REPNE CMPS æœªæ¯”è¾ƒå®Œä¸”ä¸ç›¸ç­‰æ—¶ç»§ç»­
- SCAS åœ¨ DI ä¸­æœç´¢ AL
- LODS 
- STOS 

### è¾“å…¥è¾“å‡º

I/O ç©ºé—´

- IN
  - IN AL/AX/EAX, ç«‹å³æ•°
  - IN AL/AX/EAX, DX
- OUT åŒä¸Š

### ä¸­æ–­

### win32

- 32 ä½
- è¾“å…¥è¾“å‡ºé€€å‡ºç­‰éœ€è¦è°ƒç”¨ api
  - åŠ¨æ€é“¾æ¥
- åº“
  - user32.lib
  - kernel32.lib

### æŒ‡ä»¤åˆé›†

```assembly
MOV OPD, OPS; MOVE DEST SRC

XLAT; TRANSLATE ([BX+AL])->AL 

LEA OPD, OPS; LOAD EFFECTIVE ADDRESS ç«‹å³å¯»å€ ç­‰ä»·äº MOV OPD, OFFSET OPS, å…¶ä¸­ OPD å¿…é¡»æ˜¯ 16/32 ä½å¯„å­˜å™¨

;æ ‡å¿—ä½?

NEG OPD; NEGTIVE å°† OPD çš„æ¯ä¸€ä½å–åæœ€ååŠ ä¸€, åŒ…æ‹¬ç¬¦å·ä½, å¾—åˆ°ç»“è®º: è´Ÿæ•°"å–è¡¥ç "å¾—åˆ°ç»å¯¹å€¼

IMUL OPD, OPS;INTEGER MULTIPLICATION (OPD)*(OPS)->OPD
IMUL OPD, OPS, N; (OPS)*N->OPD
IMUL OPS; 
(AL)*(OPS)->AX
(AX)*(OPS)->DX, AX
(EAX)*(OPS)->EDX, EAX
MUL

DIV OPS;
(AX)/(OPS)->AL å•†, AH ä½™æ•°
(DX, AX)/(OPS)->AX å•†, AH ä½™æ•°
(EDX, EAX)/(OPS)->EAXå•†, EDXä½™æ•°
IDIV

NOT OPD; å–å
AND OPD, OPS; é€»è¾‘ä¸
TEST OPD, OPS
å¸¸è§ç”¨æ³•: TEST ECX, ECX åˆ¤æ–­ ecx æ˜¯å¦ä¸ºç©º, å¦‚æœä¸ºç©ºåˆ™ zf=1
æ€»ç»“: test æ˜¯é€»è¾‘ä¸è¿ç®—, cmp æ˜¯ sub è¿ç®—, cmp a1, a2 æ‰§è¡Œæ“ä½œ a1-a2
XOR OPD, OPS; å¼‚æˆ–

SAL OPD, N æˆ–è€… SHL OPD, N; ARITHMATIC SHIFT LEFT, SHIFT LEFT å·¦ç§», é€»è¾‘ç®—æ•°éƒ½ä¸€æ ·
SHR OPD, N; é€»è¾‘å³ç§», åŠ  0
SAR OPD, N; ç®—æ•°å³ç§», åŠ ç¬¦å·ä½

ROL OPD, N; å¾ªç¯å·¦ç§»
ROR OPD, N
RCL OPD, N; ROTATE LEFT WITH CARRY å¸¦è¿›ä½å¾ªç¯å·¦ç§»
RCR OPD, N




INT; INTERRUPT

DW; DEFINE WORD

PROC; PROCEDURE

ENDS; END SEGMENT

PTR; POINTER

MOVSX; EXTENDED MOVE WITH SIGN DATA
MOVZX; EXTENDED MOVE WITH ZERO DATA


***********************


PUSH OPS; SP=SP-1

POP OPD; SP=SP+1

DIV;https://blog.csdn.net/loovejava/article/details/7044242

IMUL OPD, OPS; æœ‰ç¬¦å·æ•°ä¹˜æ³•
IMUL OPD, OPS, N; OPS*N->OPD
IMUL OPS; AL*OPS->AX å­—èŠ‚
					AX*OPS->DX,AX å­—
					EAX*OPS->EDX,EAX åŒå­—
MUL;æ— ç¬¦å·ä¹˜æ³•,ç”¨æ³•åŒä¸Š

ADD AX,10;æŠŠ ax åŠ ä¸Š 10 å†å­˜åˆ° ax é‡Œ

SUB

LOOP æ ‡å·

é€»è¾‘ç§»ä½, æ€»æ˜¯ç”¨ 0 è¡¥å……
SHL EDX, 7;EDX å·¦ç§» 7 ä½
shr ;å³ç§»

ç®—æ•°ç§»ä½, ç”¨ç¬¦å·ä½è¡¥å……
sar;å³ç§»

CBW ;å°† AL ä¸­çš„ç¬¦å·æ‰©å±•åˆ° AH é‡Œ

;æ„ä¹‰    æ— ç¬¦å·æ¯”è¾ƒ     æœ‰ç¬¦å·æ¯”è¾ƒ
>        JA, JNBE     JG, JNLE
>=			 JAE, JNB			JNC, JGE, JNL
<				 JB, JNAE			JC, JL, JN, JNGE
<				 JBE, JNA			JLE, JNG

CMP BYTE PTR[SI],"#" ;ptrå‰é¢çš„ç±»å‹æœ‰byteï¼ˆå­—èŠ‚ï¼‰ã€wordï¼ˆå­—ï¼‰ã€dwordï¼ˆåŒå­—ï¼‰ã€qwordï¼ˆå››å­—ï¼‰ã€tbyteï¼ˆåå­—èŠ‚ï¼‰ã€farï¼ˆè¿œç±»å‹ï¼‰å’Œnearï¼ˆè¿‘ç±»å‹ï¼‰

LEA 
leaæŒ‡ä»¤
load effective address, åŠ è½½æœ‰æ•ˆåœ°å€ï¼Œå¯ä»¥å°†æœ‰æ•ˆåœ°å€ä¼ é€åˆ°æŒ‡å®šçš„çš„å¯„å­˜å™¨ã€‚æŒ‡ä»¤å½¢å¼æ˜¯ä»å­˜å‚¨å™¨è¯»æ•°æ®åˆ°å¯„å­˜å™¨, æ•ˆæœæ˜¯å°†å­˜å‚¨å™¨çš„æœ‰æ•ˆåœ°å€å†™å…¥åˆ°ç›®çš„æ“ä½œæ•°, ç®€å•è¯´, å°±æ˜¯Cè¯­è¨€ä¸­çš„â€&â€.
movæŒ‡ä»¤
åœ¨CPUå†…æˆ–CPUå’Œå­˜å‚¨å™¨ä¹‹é—´ä¼ é€å­—æˆ–å­—èŠ‚ï¼Œå®ƒä¼ é€çš„ä¿¡æ¯å¯ä»¥ä»å¯„å­˜å™¨åˆ°å¯„å­˜å™¨ï¼Œç«‹å³æ•°åˆ°å¯„å­˜å™¨ï¼Œç«‹å³æ•°åˆ°å­˜å‚¨å•å…ƒï¼Œä»å­˜å‚¨å•å…ƒåˆ°å¯„å­˜å™¨ï¼Œä»å¯„å­˜å™¨åˆ°å­˜å‚¨å•å…ƒï¼Œä»å¯„å­˜å™¨æˆ–å­˜å‚¨å•å…ƒåˆ°é™¤CSå¤–çš„æ®µå¯„å­˜å™¨(æ³¨æ„ç«‹å³æ•°ä¸èƒ½ç›´æ¥é€æ®µå¯„å­˜å™¨)ï¼Œä»æ®µå¯„å­˜å™¨åˆ°å¯„å­˜å™¨æˆ–å­˜å‚¨å•å…ƒã€‚
ä½†æ˜¯æ³¨æ„
ï¼ˆ1ï¼‰ MOVæŒ‡ä»¤ä¸­çš„æºæ“ä½œæ•°ç»å¯¹ä¸èƒ½æ˜¯ç«‹å³æ•°å’Œä»£ç æ®µCSå¯„å­˜å™¨ï¼›
ï¼ˆ2ï¼‰ MOVæŒ‡ä»¤ä¸­ç»å¯¹ä¸å…è®¸åœ¨ä¸¤ä¸ªå­˜å‚¨å•å…ƒä¹‹é—´ç›´æ¥ä¼ é€æ•°æ®ï¼›
ï¼ˆ3ï¼‰ MOVæŒ‡ä»¤ä¸­ç»å¯¹ä¸å…è®¸åœ¨ä¸¤ä¸ªæ®µå¯„å­˜å™¨ä¹‹é—´ç›´æ¥ä¼ é€æ•°æ®ï¼›
ï¼ˆ4ï¼‰ MOVæŒ‡ä»¤ä¸ä¼šå½±å“æ ‡å¿—ä½
ä½¿ç”¨[]åŒºåˆ«
ç¬¬äºŒæ“ä½œæ•°åŠ ä¸åŠ ä¸­æ‹¬å·[]çš„åŒºåˆ«å°±æ˜¯:
leaå¯¹å˜é‡æ²¡æœ‰å½±å“æ˜¯å–åœ°å€,å¯¹å¯„å­˜å™¨æ¥è¯´åŠ []æ—¶å–å€¼,ç¬¬äºŒæ“ä½œæ•°ä¸åŠ []éæ³•
movå¯¹å˜é‡æ¥è¯´æ²¡æœ‰å½±å“æ˜¯å–å€¼,å¯¹å¯„å­˜å™¨æ¥è¯´æ˜¯åŠ []æ—¶å–åœ°å€,ç¬¬äºŒæ“ä½œæ•°ä¸åŠ []æ˜¯å–å€¼
```

